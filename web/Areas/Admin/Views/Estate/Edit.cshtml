@model DAL.Entities.Estate
@{
    ViewBag.Title = "Add";
    Layout = "~/Areas/Admin/Views/Shared/adminlayout.cshtml";
}
<style>
    .MultiFile-label {
        margin-top: 10px;
    }
</style>
<link href="~/Areas/Admin/Content/styles/pluginstyles/jquery.msgbox.css" rel="stylesheet" />
<link href="~/Areas/Admin/Content/styles/forms.css" rel="stylesheet" />
<link href="~/Areas/Admin/Content/styles/table.css" rel="stylesheet" />
<script src="~/Areas/Admin/Content/scripts/plugins/jquery.MultiFile.js"></script>

@Html.Partial("_leftmenu")

<div id="page-content" class="container_12">
  <div id="page-header">
        <h1>EMLAK İŞLEMLERİ</h1>
   </div>
  <section class="grid_12 form">
    @Html.Hidden("ProcessMessage",(object)@ViewBag.ProcessMessage) 
    @using(Html.BeginForm("Edit", "Estate", FormMethod.Post, new { enctype = "multipart/form-data"}))
    {
    
        @Html.ValidationSummary(true)
        <fieldset>
        <legend>Emlak Düzenle</legend>
         <p>
            @Html.LabelFor(m=>m.Language)
            @Html.DropDownListFor(m=>m.Language,(IEnumerable<SelectListItem>)ViewBag.LanguageList,"Dil Seçiniz...")
            @Html.ValidationMessageFor(m=>m.Language)
           
        </p>
         <p>
            @Html.LabelFor(m=>m.ReferenceNo)
            @Html.TextBoxFor(m=>m.ReferenceNo, new { @class="textwidth20"})
            @Html.ValidationMessageFor(m=>m.ReferenceNo)
        </p>
            <p>
            @Html.LabelFor(m=>m.Header)
            @Html.TextBoxFor(m=>m.Header, new { @class="textwidth50"})
            @Html.ValidationMessageFor(m=>m.Header)
        </p>
         <p>
            @Html.LabelFor(m=>m.Content)
            @Html.TextAreaFor(m=>m.Content, new { @class="textwidth50"})
            @Html.ValidationMessageFor(m=>m.Content)
        </p>
        <p>
            @Html.LabelFor(m=>m.TypeId)
            @Html.DropDownListFor(x => x.TypeId, new SelectList(
                  new List<Object>{ 
                       new { value = "0" , text = "Kiralık"  },
                       new { value = "1" , text = "Satılık" },
                    },
                  "value",
                  "text",
                   0), new { @class="textwidth10"})
        </p>
        <p>
            @Html.LabelFor(m=>m.RoomNumber)
            @Html.TextBoxFor(m=>m.RoomNumber, new { @class="textwidth10"})
         </p>
        <p>
            @Html.LabelFor(m=>m.Age)
            @Html.TextBoxFor(m=>m.Age, new { @class="textwidth10"})
        </p>
         <p>
            @Html.LabelFor(m=>m.Size)
            @Html.TextBoxFor(m=>m.Size, new { @class="textwidth10"})
        </p>
        <p>
            @Html.LabelFor(m=>m.Consultant)
            @Html.TextBoxFor(m=>m.Consultant, new { @class="textwidth50"})
        </p>
         <p>
            @Html.LabelFor(m=>m.Price)
            @Html.TextBoxFor(m=>m.Price, new { @Value = Model.Price.ToString("0") })
             
                  @Html.DropDownListFor(x => x.PriceTypeId, new SelectList(
                  new List<Object>{ 
                       new { value = "TL" , text = "TL"  },
                       new { value = "$" , text = "$" },
                    },
                  "value",
                  "text",
                   0), new { @class="textwidth10"})
                  @Html.ValidationMessageFor(m=>m.Price)

        </p>
        <p>
            @Html.LabelFor(m=>m.TimeCreated)
            @Html.TextBoxFor(m=>m.TimeCreated, new { @class="textwidth10"})
             @Html.ValidationMessageFor(m=>m.TimeCreated)
        </p>
        <p>
            @Html.LabelFor(m=>m.Popular)
            @Html.CheckBoxFor(m=>m.Popular)
          
        </p>
       <fieldset>
            <legend>Ana Fotoğraf</legend>
            <div id="uploadPartial">
                @Html.Partial("_imageUploadAndCrop")
            </div>
        </fieldset>
            <p style="float: left; margin-right: 4px !important;">
                    <label>Referans Fotoğrafları</label>
                </p>
                <div style="width: 249px; width: 25%; float: left">
                    <input type="file" style="width: 99%" name="attachments" class="multi" />
                </div>
                <div style="height: 40px; clear: both;"></div>
                <fieldset>
                    <legend>Diğer Fotoğraflar</legend>
                    @{Html.RenderAction("Photos", "ProjectReference", new { categoryId = (int)web.Areas.Admin.Helpers.PhotoType.Estate, itemId = Model.Id });}
                </fieldset>
        <fieldset>
            <legend>İl/İlçe/Semt</legend>
            <p>
                @Html.LabelFor(m=>m.CountryId)
                @Html.DropDownListFor(m=>m.CountryId,(IEnumerable<SelectListItem>)ViewBag.Country,"İl Seçiniz...")
                @Html.ValidationMessageFor(m=>m.CountryId)
            </p>
             <p>
                @Html.LabelFor(m=>m.TownId)
                @Html.DropDownListFor(m=>m.TownId,(IEnumerable<SelectListItem>)ViewBag.Town,"İlçey Seçiniz...")
                @Html.ValidationMessageFor(m=>m.TownId)
            </p>
             <p>
                @Html.LabelFor(m=>m.DistrictId)
                @Html.DropDownListFor(m=>m.DistrictId,(IEnumerable<SelectListItem>)ViewBag.District,"Semti Seçiniz...")
                @Html.ValidationMessageFor(m=>m.DistrictId)
            </p>
        </fieldset>
      
        <p>
            <input type="submit" value="Kaydet" id="btnsave" />
        </p>
       
    </fieldset>
    }
</section>
</div>
@section Scripts {
<link href="~/Areas/Admin/Content/styles/pluginstyles/jquery.msgbox.css" rel="stylesheet" />
<script src="~/Areas/Admin/Content/scripts/plugins/jquery.msgbox.min.js"></script>
<script src="~/Areas/Admin/Content/scripts/myscripts/MessageBox.js"></script>
<script src="~/Areas/Admin/Content/scripts/plugins/jquery.validate.js"></script>
<script src="~/Areas/Admin/Content/scripts/plugins/jquery.validate.unobtrusive.js"></script>
<script src="~/Areas/Admin/Content/scripts/plugins/jquery.ui.datepicker-tr.js"></script>
<script src="~/Areas/Admin/Content/scripts/pagescripts/reference/addreference.js"></script>
    <script src="~/Areas/Admin/Content/scripts/pagescripts/estate/editestate.js"></script>
}

<script>
    function rg_click_handler() {
        var newpath = $("#imgNewImage").attr('src');
        var photoId = $("#currenPhotoId").val();

        newpath = "/Content/images/userfiles/" + newpath.split('=')[1] + "." + photoId.split('.')[1];
        if (newpath == "") {
            alert("Lütfen resim kırpma işlemini yapınız...");
            return false;
        }
        $("#btnResimGuncelle").css("display", "none");

        $.ajax({
            type: 'POST',
            url: '@Url.Action("UpdatePhotoPath", "Project")',
            data: "{'photoId':'" + photoId.split('.')[0] + "', 'newpath':'" + newpath + "'}",
            contentType: "application/json; charset=utf-8",
            dataType: 'json',
            success: function (result) {
                $('#uploadPartial').load('@Url.Action("imageUploadAndCrop", "Media")');

                $.gritter.add({
                    title: 'Resim güncelleme!',
                    text: 'Resim kırpma işlemi başarı ile gerçekleştirilmiştir...'
                });
            },
            error: function () {

            }
        });
        }
        $("#btnResimGuncelle").bind("click", rg_click_handler);
</script>

       